name: üîç Validate Site

on:
  # Run on all pushes and PRs
  push:
    branches: [ main, master, develop ]
  pull_request:
    branches: [ main, master ]
  
  # Allow manual triggering
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest
    name: Validate Website Files
    
    steps:
      - name: üìÇ Checkout repository
        uses: actions/checkout@v4
        
      - name: üîç Validate HTML structure
        run: |
          echo "üîç Validating HTML files..."
          
          # Check required HTML files exist
          required_files=("index.html" "nosotros.html" "fundador.html" "servicios.html" "testimonios.html" "contacto.html" "404.html")
          
          for file in "${required_files[@]}"; do
            if [ -f "$file" ]; then
              echo "‚úÖ $file exists"
              
              # Basic HTML validation
              if grep -q "<!DOCTYPE html>" "$file"; then
                echo "‚úÖ $file has DOCTYPE"
              else
                echo "‚ùå $file missing DOCTYPE"
                exit 1
              fi
              
              if grep -q "<title>" "$file"; then
                echo "‚úÖ $file has title tag"
              else
                echo "‚ö†Ô∏è $file missing title tag"
              fi
              
              if grep -q 'lang="es"' "$file"; then
                echo "‚úÖ $file has Spanish language attribute"
              else
                echo "‚ö†Ô∏è $file missing or incorrect language attribute"
              fi
              
            else
              echo "‚ùå $file is missing!"
              exit 1
            fi
          done
          
      - name: üé® Validate CSS files  
        run: |
          echo "üé® Validating CSS files..."
          
          if [ -d "css" ]; then
            css_files=$(find css -name "*.css" -type f | wc -l)
            echo "‚úÖ Found $css_files CSS files"
            
            # Check main CSS file exists
            if [ -f "css/main.css" ]; then
              echo "‚úÖ Main CSS file exists"
            else
              echo "‚ùå Main CSS file missing"
              exit 1
            fi
          else
            echo "‚ùå CSS directory missing"
            exit 1
          fi
          
      - name: ‚ö° Validate JavaScript files
        run: |
          echo "‚ö° Validating JavaScript files..."
          
          if [ -d "js" ]; then
            js_files=$(find js -name "*.js" -type f | wc -l)
            echo "‚úÖ Found $js_files JavaScript files"
            
            # Check global JS file exists
            if [ -f "js/global.js" ]; then
              echo "‚úÖ Global JS file exists"
            else
              echo "‚ö†Ô∏è Global JS file missing"
            fi
          else
            echo "‚ö†Ô∏è JavaScript directory missing"
          fi
          
      - name: üñºÔ∏è Validate media files
        run: |
          echo "üñºÔ∏è Validating media files..."
          
          if [ -d "media" ]; then
            # Count different media types
            images=$(find media -name "*.jpg" -o -name "*.jpeg" -o -name "*.png" -o -name "*.gif" -o -name "*.webp" -o -name "*.svg" | wc -l)
            fonts=$(find media -name "*.woff" -o -name "*.woff2" -o -name "*.ttf" | wc -l)
            
            echo "‚úÖ Found $images image files"
            echo "‚úÖ Found $fonts font files"
            
            # Check favicon exists
            if [ -f "media/favicon/favicon.ico" ] || [ -f "media/favicon/favicon.svg" ]; then
              echo "‚úÖ Favicon found"
            else
              echo "‚ö†Ô∏è Favicon not found"
            fi
          else
            echo "‚ùå Media directory missing"
            exit 1
          fi
          
      - name: üîß Validate configuration files
        run: |
          echo "üîß Validating configuration files..."
          
          # Check redirects file
          if [ -f "_redirects" ]; then
            echo "‚úÖ _redirects file exists"
            
            # Validate redirects syntax (basic check)
            if grep -q "404" "_redirects"; then
              echo "‚úÖ 404 handling configured in _redirects"
            else
              echo "‚ö†Ô∏è No 404 handling found in _redirects"
            fi
          else
            echo "‚ö†Ô∏è _redirects file missing"
          fi
          
          # Check headers file  
          if [ -f "_headers" ]; then
            echo "‚úÖ _headers file exists"
          else
            echo "‚ö†Ô∏è _headers file missing"
          fi
          
          # Check Netlify config
          if [ -f "netlify.toml" ]; then
            echo "‚úÖ netlify.toml exists"
          else
            echo "‚ö†Ô∏è netlify.toml missing"
          fi
          
      - name: üåê Check internal links
        run: |
          echo "üåê Checking internal links..."
          
          # Check if pages link to each other correctly
          for file in *.html; do
            if [ -f "$file" ]; then
              echo "Checking links in $file..."
              
              # Look for internal navigation links
              if grep -q 'href="nosotros"' "$file" || grep -q 'href="/nosotros"' "$file"; then
                echo "‚úÖ $file has link to nosotros"
              fi
              
              if grep -q 'href="servicios"' "$file" || grep -q 'href="/servicios"' "$file"; then
                echo "‚úÖ $file has link to servicios"
              fi
            fi
          done
          
      - name: üìä Generate validation report
        run: |
          echo "üìä VALIDATION REPORT"
          echo "==================="
          echo "‚úÖ All required HTML files present"
          echo "‚úÖ CSS structure validated"
          echo "‚úÖ Media files checked"
          echo "‚úÖ Configuration files reviewed"
          echo ""
          echo "üöÄ Site is ready for deployment!"
